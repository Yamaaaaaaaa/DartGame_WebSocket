<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.text.*?>
<?import javafx.geometry.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:id="rootPane"
            fx:controller="controllers.StartGameWithBotController"
            prefWidth="1000" prefHeight="600">

    <!-- Header -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 10;">
            <Button text="← Quay lại" onAction="#handleBack"/>
            <Label text="Dart Game 301" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
        </HBox>
    </top>

    <!-- Updated main layout -->
    <center>
        <HBox spacing="0">
            <!-- Game area -->
            <VBox prefWidth="650" prefHeight="600" alignment="TOP_CENTER" spacing="0">
                
                <!-- Dartboard area with overlay -->
                <HBox prefWidth="650" prefHeight="400" alignment="CENTER">
                    <StackPane fx:id="boardContainer" prefWidth="450" prefHeight="400">
                        <!-- Bàn phi tiêu -->
                        <Pane fx:id="gamePane" prefWidth="450" prefHeight="400" 
                              style="-fx-border-color: black; -fx-background-color: #f5f5f5;"/>
                        
                        <!-- Overlay loading lượt Bot -->
                        <VBox fx:id="botTurnOverlay" alignment="CENTER" spacing="10"
                              visible="false" mouseTransparent="true"
                              style="-fx-background-color: rgba(0,0,0,0.4);">
                            <ProgressIndicator fx:id="botLoadingIndicator" prefWidth="50" prefHeight="50"/>
                            <Label text="Lượt của Bot"
                                   style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                        </VBox>
                    </StackPane>
                </HBox>

                <!-- Controls -->
                <VBox prefWidth="650" prefHeight="100" alignment="CENTER" spacing="10" style="-fx-padding: 10;">
                    <Button fx:id="startButton" text="START GAME" prefWidth="160" prefHeight="50"
                            onAction="#handleGameAction"
                            style="-fx-background-color: linear-gradient(to bottom, #4CAF50, #45a049); 
                                   -fx-text-fill: white; 
                                   -fx-font-weight: bold; 
                                   -fx-font-size: 16px; 
                                   -fx-border-radius: 8px; 
                                   -fx-background-radius: 8px; 
                                   -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.5), 10, 0, 0, 5); 
                                   -fx-cursor: hand; 
                                   -fx-opacity: 0.95;"/>
                    <HBox spacing="5" alignment="CENTER">
                        <Label text="Nhập góc xoay:"/>
                        <TextField fx:id="angleInput" prefWidth="80"/>
                        <Button text="Xoay" onAction="#handleRotateBoard"/>
                    </HBox>
                    <Label fx:id="instructionLabel" text="Click START GAME to begin 301 Dart Game" 
                           style="-fx-font-size: 14px; -fx-font-weight: bold;" alignment="CENTER_LEFT"/>
                </VBox>
                
                <Region VBox.vgrow="ALWAYS"/>
                
                <!-- Scoreboard -->
                <HBox prefWidth="570" prefHeight="100" alignment="CENTER" style="-fx-margin-bottom: 20px;">
                    <Pane fx:id="scoreboardPane" prefWidth="570" prefHeight="100"
                          style="-fx-border-color: black;"/>
                </HBox>
            </VBox>

            <!-- Chat area -->
            <BorderPane prefWidth="350" prefHeight="600" 
                    style="-fx-background-color: rgba(255,255,255,0.15);
                    -fx-background-radius: 15;
                    -fx-border-color: rgba(255,255,255,0.3);
                    -fx-border-radius: 15;
                    -fx-padding: 10;
                    -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.3), 8, 0.2, 0, 2);">
                <top>
                    <Label text="Chat" style="-fx-padding: 10; -fx-font-weight: bold;"/>
                </top>
                <center>
                    <ListView fx:id="chatList" prefWidth="330" prefHeight="500"  style="-fx-background-color: transparent;
                         -fx-control-inner-background: transparent;
                         -fx-border-color: transparent;
                         -fx-text-fill: black;
                         -fx-font-size: 13px;"/>
                </center>
                <bottom>
                    <HBox spacing="5" alignment="CENTER" style="-fx-padding: 5;">
                        <TextField fx:id="chatInput" HBox.hgrow="ALWAYS" style="-fx-background-color: linear-gradient(to bottom, #4caf50, #2e7d32);
                           -fx-background-radius: 10;
                           -fx-text-fill: white;
                           -fx-font-weight: bold;
                           -fx-cursor: hand;"/>
                        <Button text="Gửi" onAction="#handleSend"/>
                    </HBox>
                </bottom>
            </BorderPane>
        </HBox>
    </center>
</BorderPane>
