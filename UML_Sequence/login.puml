@startuml
actor User as "Người dùng"
participant LC as "LoginController (Client)"
participant SH as "SocketHandler (Client)"
participant C as "Client (Server Thread)"
participant UC as "UserController (Server)"
database DB as "Database"

User ->> LC: Nhập Username/Password & Bấm Đăng nhập
LC ->> SH: login(username, password)
activate SH
SH -> SH: Chuẩn bị data: "LOGIN;user;pass"
SH -> C: sendData() qua Socket
deactivate SH

activate C
C -> C: receive data "LOGIN;..."
C -> C: onReceiveLogin()
C -> UC: login(username, password)
activate UC
UC -> DB: SQL: SELECT ... WHERE username=? AND password=?
activate DB
DB --> UC: Trả về Result Set
deactivate DB

alt Thành công (Tồn tại user)
    UC --> C: "success;username"
else Thất bại (Sai user/pass)
    UC --> C: "failed;msg"
end
deactivate UC

C -> C: sendData("LOGIN;result")
alt Thành công
    C -> C: set loginUser = username
    C -> C: onReceiveGetListOnline()
    C -> C: Gọi ClientManager.getListUseOnline()
    C -> C: Gọi ClientManager.broadcast("GET_LIST_ONLINE;...")
end

C -> SH: Dữ liệu "LOGIN;result" qua Socket
deactivate C

activate SH
SH -> SH: listen() / onReceiveLogin()
alt Thành công
    SH -> SH: Lưu loginUser
    SH -> LC: Main.setRoot("home") (Chuyển trang)
else Thất bại
    SH -> LC: Hiển thị lỗi (ví dụ: System.out.println)
end
deactivate SH
@enduml
